<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Reservation - Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            /* 垂直居中 */
            justify-content: center;
            /* 水平居中 */
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: "Segoe UI", sans-serif;
        }

        .login-card {
            width: 100%;
            max-width: 420px;
            background: #fff;
            border-radius: 16px;
            padding: 40px 30px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease;
        }

        .login-logo img {
            max-height: 80px;
        }

        .btn-primary {
            background-color: #28a745;
            border: none;
        }

        .btn-primary:hover {
            background-color: #218838;
        }

        .form-control:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="login-card">
        <div class="login-logo text-center mb-4">
            <img src="/static/views/Image/PolyUlogo.png" alt="PolyU Logo">
        </div>

        <!-- ✅ Login Form -->
        <form id="loginForm">
            <input type="hidden" name="action" value="login">

            <div class="mb-3">
                <label for="email" class="form-label fw-semibold">Email</label>
                <input type="email" class="form-control" id="email" name="email" placeholder="Enter email" required>
            </div>

            <div class="mb-3">
                <label for="password" class="form-label fw-semibold">Password</label>
                <input type="password" class="form-control" id="password" name="password" placeholder="Enter password"
                    required>
            </div>

            <div class="mb-3">
                <label for="captcha" class="form-label fw-semibold">Captcha</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="captcha" name="captcha" placeholder="Enter captcha"
                        required>
                    <button type="button" class="btn btn-outline-success" id="getCaptcha">Get Captcha</button>
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-3">Login</button>

            <div class="text-center mt-3">
                <a href="https://eastyltd.com/create-new-user/" class="text-decoration-none">Create New Account</a>
            </div>
            <div class="text-center mt-2">
                <a href="https://eastyltd.com/forget-password/" class="text-decoration-none">Forgot Password?</a>
            </div>
        </form>

        <!-- ✅ Response Message -->
        <div id="responseMessage" class="mt-4 text-center"></div>
    </div>

    <!-- jQuery (必须先引入) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- 自定义脚本 -->
    <script>
        // 点击 "Get Captcha" 按钮
        $('#getCaptcha').on('click', function () {
            const email = $('#email').val().trim();
            $('#responseMessage').empty();

            if (!email) {
                $('#responseMessage').html('<div class="alert alert-warning">⚠️ Please enter your email first.</div>');
                return;
            }

            $.get("api/send-captcha", { email: email })
                .done(function (resp) {
                    console.log("Server response:", resp);
                    $('#responseMessage').html('<div class="alert alert-success">✅ Captcha has been sent to your email aa.</div>');
                })
                .fail(function (xhr) {
                    console.error("AJAX error:", xhr.status, xhr.responseText);
                    $('#responseMessage').html('<div class="alert alert-danger">❌ Failed to send captcha.</div>');
                });
        });

        $('#loginForm').on('submit', function (e) {
            e.preventDefault(); // 阻止默认提交表单

            const formData = $(this).serialize(); // 获取 email, password, captcha

            $.post("/api/check-login", formData)
                .done(function (resp) {
                    console.log("Login response:", resp);

                    if (resp.status === "OK") {
                        // ✅ 登录成功，跳转对应页面
                        window.location.href = resp.redirect;
                    } else {
                        // ❌ 返回错误
                        $('#responseMessage').html('<div class="alert alert-danger">' + resp.error + '</div>');
                    }
                })
                .fail(function (xhr) {
                    console.error("AJAX error:", xhr.status, xhr.responseText);
                    $('#responseMessage').html('<div class="alert alert-danger">❌' + responseText + '.</div>');
                });
        });
    </script>

</body>

</html>