<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Student - Time Slot Groups</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    /* âœ… è‡ªè¨‚ä¸»é¡Œç´… */
    .bg-primary-red {
      background-color: #C8102E !important;
    }

    .text-primary-red {
      color: #C8102E !important;
    }

    .btn-primary-red {
      background-color: #C8102E !important;
      border-color: #C8102E !important;
      color: #fff;
    }

    .btn-primary-red:hover {
      background-color: #A00D25 !important;
      border-color: #A00D25 !important;
    }

    .table-primary-red {
      background-color: #C8102E !important;
      color: #fff;
    }
  </style>
</head>

<body class="bg-light">
  <div id="nav-container"></div>

  <div class="container py-4" style="margin-top:140px;">
    <div class="card shadow-lg">
      <!-- ðŸ”´ æ”¹ç”¨ä¸»é¡Œç´… -->
      <div class="card-header bg-primary-red text-white d-flex align-items-center">
        <i class="bi bi-clipboard-check me-2"></i>
        <h5 class="mb-0">Waiting Booking</h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle mb-0">
            <thead class="table-primary-red">
              <tr>
                <th scope="col">Title</th>
                <th scope="col">Teacher</th>
                <th scope="col">Content</th>
                <th scope="col">Deadline</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody id="groupList"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    $(function () {
      $("#nav-container").load("StudentMenu.html");

      $.ajax({
        url: "/api/getTimeslotGroup",
        method: "GET",
        dataType: "json",
        success: function (data) {
          let list = data.groups || [];

          if (list.length === 0) {
            $("#groupList").html(
              `<tr><td colspan="6" class="text-center text-muted">No time slot groups available.</td></tr>`
            );
            return;
          }

          list.forEach(item => {
            const deadlineDate = new Date(item.deadline);
            const now = new Date();
            const isExpired = deadlineDate < now;

            let row = `
              <tr>
                <td><span class="fw-bold text-primary-red">${item.title}</span></td>
                <td><i class="bi bi-person-circle text-primary-red"></i> ${item.teacher_name || "N/A"}</td>
                <td>${item.content || ""}</td>
                <td><i class="bi bi-clock-history text-primary-red"></i> ${item.deadline || "N/A"}</td>
                <td>
                  <button class="btn ${isExpired ? "btn-outline-secondary" : "btn-primary-red"} btn-sm bookBtn"
                          value="${item.group_id}" ${isExpired ? "disabled" : ""}>
                    ${isExpired ? "Expired" : "View"}
                  </button>
                </td>
              </tr>`;
            $("#groupList").append(row);
          });

          $(".bookBtn").on("click", function () {
            const gid = $(this).val();

            // å­˜åˆ° sessionStorage
            sessionStorage.setItem("selected_gid", gid);


            window.location.href = "studentViewBookingSlot.html";
          });

        },
        error: function (xhr, status, error) {
          $("#groupList").html(
            `<tr><td colspan="6" class="text-center text-danger">Failed to load groups.</td></tr>`
          );
        }
      });
    });
  </script>
</body>

</html>